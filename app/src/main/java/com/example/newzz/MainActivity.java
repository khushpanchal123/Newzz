package com.example.newzz;

import android.annotation.SuppressLint;
import android.net.Uri;
import android.os.Bundle;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.browser.customtabs.CustomTabsIntent;
import androidx.loader.app.LoaderManager;
import androidx.loader.content.AsyncTaskLoader;
import androidx.loader.content.Loader;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import org.json.JSONException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class MainActivity extends AppCompatActivity implements LoaderManager.LoaderCallbacks<List<News>>, NewsAdapter.NewsListner {

    private List<News> mNewsList;
    private NewsAdapter mNewsAdapter;
    private static final int LOADER_ID = 0;

    //private static final String JSON_RESPONSE = "https://newsapi.org/v2/top-headlines?country=us&apiKey=c3a342cc6d394cb19fc3db635741e77f";
    private static final String JSON_RESPONSE = "{\"status\":\"ok\",\"totalResults\":38,\"articles\":[{\"source\":{\"id\":\"google-news\",\"name\":\"Google News\"},\"author\":null,\"title\":\"Best of Day 8 at the Tokyo Olympics: Another world record for Caeleb Dressel | NBC Sports - NBC Sports\",\"description\":null,\"url\":\"https://news.google.com/__i/rss/rd/articles/CBMiK2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9cnIyUDFSb2FkYmvSAQA?oc=5\",\"urlToImage\":null,\"publishedAt\":\"2021-07-31T11:45:24Z\",\"content\":null},{\"source\":{\"id\":\"politico\",\"name\":\"Politico\"},\"author\":\"Burgess Everett, Marianne LeVine\",\"title\":\"McConnell stirs GOP intrigue with support for Biden’s infrastructure bill - POLITICO\",\"description\":\"Even the Senate minority leader's No. 2 didn't know until the last minute where he would land. His fellow Republicans still aren't sure.\",\"url\":\"https://www.politico.com/news/2021/07/31/mcconnell-gop-biden-infrastructure-bill-501880\",\"urlToImage\":\"https://static.politico.com/c9/8e/a29ba084465c903b270ee4a3a389/210730-mcconnell-thune-getty-773.jpg\",\"publishedAt\":\"2021-07-31T11:00:39Z\",\"content\":\"The rumbling on the floor was the first I heard about it. And then boom, the tweet came out right after that, said Sen. John Thune (R-S.D.), McConnells top deputy as the GOP whip. The leader just kin… [+6637 chars]\"},{\"source\":{\"id\":null,\"name\":\"Fox Business\"},\"author\":\"Nate Day\",\"title\":\"Scarlett Johansson vs. Disney: Why execs cash in on streaming but creatives don’t - Fox Business\",\"description\":\"Scarlett Johansson made headlines on Thursday when she sued Disney over its day-and-date release of “Black Widow” on Disney+.\",\"url\":\"https://www.foxbusiness.com/lifestyle/scarlett-johansson-disney-why-execs-cash-in-streaming-creatives-dont\",\"urlToImage\":\"https://a57.foxnews.com/static.foxbusiness.com/foxbusiness.com/content/uploads/2021/07/0/0/scarlett-black-widow-ap.jpg?ve=1&tl=1\",\"publishedAt\":\"2021-07-31T10:47:51Z\",\"content\":\"Scarlett Johansson made headlines on Thursday when she sued Disney over its day-and-date release of \\\"Black Widow\\\" on Disney+ and in theaters, citing breach of contract.\\r\\nSince the suit was filed, Dis… [+3394 chars]\"},{\"source\":{\"id\":null,\"name\":\"The Times of Israel\"},\"author\":null,\"title\":\"Multiple Iranian drones used in deadly attack on Israeli-operated ship – report - The Times of Israel\",\"description\":\"NYT cites Israeli officials who say several UAVs apparently slammed into vessel's living area; US Navy experts inspect boat, find 'clear visual evidence that attack had occurred'\",\"url\":\"https://www.timesofisrael.com/multiple-iranian-drones-used-in-deadly-attack-on-israeli-operated-ship-report/\",\"urlToImage\":\"https://static.timesofisrael.com/www/uploads/2021/07/AP21211412898531-1024x640.jpg\",\"publishedAt\":\"2021-07-31T10:42:16Z\",\"content\":\"Several Iranian drones were apparently used in a strike on an oil tanker operated by an Israeli-owned company, killing two on board, unnamed Israeli officials told the New York Times on Saturday.\\r\\nTh… [+5786 chars]\"},{\"source\":{\"id\":\"nbc-news\",\"name\":\"NBC News\"},\"author\":\"Julia Ainsley, Didi Martinez\",\"title\":\"Audio from migrant shelter reveals allegations of sex misconduct by staff with minors - NBC News\",\"description\":\"Audio from a U.S. shelter for migrant kids reveals allegations of sexual misconduct by staff and reluctance by officials to reveal the size of a Covid outbreak.\",\"url\":\"https://www.nbcnews.com/politics/immigration/audio-migrant-kids-shelter-reveals-discussion-sex-between-staff-minors-n1275547\",\"urlToImage\":\"https://media-cldnry.s-nbcnews.com/image/upload/t_nbcnews-fp-1200-630,f_auto,q_auto:best/newscms/2021_27/3489067/210706-fort-bliss-mb-2002.jpg\",\"publishedAt\":\"2021-07-31T10:34:00Z\",\"content\":\"WASHINGTON New audio from inside a U.S. government shelter for unaccompanied migrant children in Fort Bliss, Texas, reveals allegations of sexual misconduct by staff toward minors, acknowledgment the… [+5003 chars]\"},{\"source\":{\"id\":\"the-wall-street-journal\",\"name\":\"The Wall Street Journal\"},\"author\":\"Arian Campo-Flores\",\"title\":\"Delta Variant Fears Spur Some Americans to Get Covid-19 Vaccine - The Wall Street Journal\",\"description\":\"Concerns about the Delta variant, confidence in vaccines’ safety and pressure from friends and family are helping people get past their hesitancy\",\"url\":\"https://www.wsj.com/articles/delta-variant-fears-spur-some-americans-to-get-covid-19-vaccine-11627723802\",\"urlToImage\":\"https://images.wsj.net/im-378158/social\",\"publishedAt\":\"2021-07-31T09:30:00Z\",\"content\":\"Growing numbers of people are getting vaccinated in areas hit hard by the Delta variant, offering a glimmer of hope but still falling far short of what is needed to fight Covid-19, public-health offi… [+1444 chars]\"},{\"source\":{\"id\":\"fox-news\",\"name\":\"Fox News\"},\"author\":\"Brie Stimson\",\"title\":\"Canadian doctor accused of using own sperm to inseminate patients to pay $10.7M in tentative settlement - Fox News\",\"description\":\"Hundreds of victims of a former Canadian fertility doctor, who allegedly used the wrong sperm and sometimes his own while artificially inseminating patients, will be awarded $10.7 million in a tentative agreement reached this week, according to reports.\",\"url\":\"https://www.foxnews.com/health/canadian-doctor-own-sperm-inseminate-patients-settlement\",\"urlToImage\":\"https://static.foxnews.com/foxnews.com/content/uploads/2021/07/iStock-816223244.jpg\",\"publishedAt\":\"2021-07-31T09:25:50Z\",\"content\":\"Hundreds of victims of a former Canadian fertility doctor, who allegedly used the wrong sperm and sometimes his own while artificially inseminating patients, will be awarded $10.7 million in a tentat… [+2755 chars]\"},{\"source\":{\"id\":\"nbc-news\",\"name\":\"NBC News\"},\"author\":\"Nancy Yang\",\"title\":\"What Suni Lee's Olympics means for America's Hmong community - NBCNews.com\",\"description\":\"Suni Lee's Tokyo Olympic Games gold medal in gymnastics means so much for America's Hmong community\",\"url\":\"https://www.nbcnews.com/think/opinion/what-suni-lee-s-olympics-means-america-s-hmong-community-ncna1275531\",\"urlToImage\":\"https://media-cldnry.s-nbcnews.com/image/upload/t_nbcnews-fp-1200-630,f_auto,q_auto:best/newscms/2021_30/3495408/210730-think-sunisa-lee-family-celebrating-se-334p.jpg\",\"publishedAt\":\"2021-07-31T08:30:00Z\",\"content\":\"When gymnast Sunisa \\\"Suni\\\" Lee stepped out on the global stage at the Tokyo Olympics, she wasnt just representing Team USA. She was also representing the Hmong community around the world. And the wor… [+5323 chars]\"},{\"source\":{\"id\":null,\"name\":\"New York Post\"},\"author\":\"Patrick Reilly\",\"title\":\"Baltimore aunt found with decomposing niece, nephew in trunk of car - New York Post \",\"description\":\"Nicole Johnson was charged with first-degree child abuse when Baltimore County police smelled something off and discovered the bodies of her niece and nephew.\",\"url\":\"https://nypost.com/2021/07/31/baltimore-woman-nicole-johnson-found-with-dead-bodies-of-niece-nephew-in-car-trunk/\",\"urlToImage\":\"https://nypost.com/wp-content/uploads/sites/2/2021/07/nicole-johnson-md-001.jpg?quality=90&strip=all&w=1200\",\"publishedAt\":\"2021-07-31T08:24:00Z\",\"content\":\"A Baltimore woman was arrested after cops found the starved and decomposing bodies of her niece and nephew in the trunk of her car during a traffic stop, police said Friday.\\r\\nNicole Johnson, 33, was … [+2895 chars]\"},{\"source\":{\"id\":null,\"name\":\"New York Times\"},\"author\":\"Mujib Mashal\",\"title\":\"Body of Reuters Photographer Was Mutilated in Taliban Custody, Officials Say - The New York Times\",\"description\":\"The body of Danish Siddiqui, a Pulitzer Prize winner killed in Afghanistan, was unrecognizable when it was brought to a Kandahar hospital, one official said.\",\"url\":\"https://www.nytimes.com/2021/07/31/world/asia/danish-siddiqui-afghanistan-photographer.html\",\"urlToImage\":\"https://static01.nyt.com/images/2021/07/31/world/31afghanistan-journalist1/31afghanistan-journalist1-facebookJumbo.jpg\",\"publishedAt\":\"2021-07-31T08:14:14Z\",\"content\":\"The Taliban rose to power from the southern province in the 1990s, promising to end atrocities carried out by local militias. In recent years, Afghan forces led by Abdul Raziq, a general who was assa… [+1566 chars]\"},{\"source\":{\"id\":null,\"name\":\"HuffPost\"},\"author\":\"Lee Moran\",\"title\":\"Dolly Parton Chimes In On Britney Spears' Conservatorship Battle - HuffPost\",\"description\":\"\\\"I went through a lot of that myself,\\\" the country music legend told Andy Cohen.\",\"url\":\"https://www.huffpost.com/entry/dolly-parton-britney-spears-free-britney_n_6104f91de4b000b997e1fa43\",\"urlToImage\":\"https://img.huffingtonpost.com/asset/6104fb4c280000bf977037f0.jpg?cache=zk6asmah1v&ops=1778_1000\",\"publishedAt\":\"2021-07-31T07:58:00Z\",\"content\":\"Country legend Dolly Parton offered her thoughts on the #FreeBritney movement on Thursdays episode of Watch What Happens Live With Andy Cohen.\\r\\nParton, 75, was asked by a fan what she thought of the … [+1011 chars]\"},{\"source\":{\"id\":\"cnn\",\"name\":\"CNN\"},\"author\":\"Travis Caldwell, CNN\",\"title\":\"The surge of Covid-19 infections for unvaccinated people is only beginning, experts warn - CNN\",\"description\":\"With the recent increase of Covid-19 infections and hospitalizations due to the spread of the more dangerous Delta variant, health experts and officials expect the surge to worsen as long as large segments of the country remain unvaccinated.\",\"url\":\"https://www.cnn.com/2021/07/31/health/us-coronavirus-saturday/index.html\",\"urlToImage\":\"https://cdn.cnn.com/cnnnext/dam/assets/210730235551-florida-covid-treatment-tent-0729-super-tease.jpg\",\"publishedAt\":\"2021-07-31T07:26:00Z\",\"content\":\"(CNN)With the recent increase of Covid-19 infections and hospitalizations due to the spread of the more dangerous Delta variant, health experts and officials expect the surge to worsen as long as lar… [+5884 chars]\"},{\"source\":{\"id\":null,\"name\":\"HuffPost\"},\"author\":\"Lee Moran\",\"title\":\"Ex-Trump Official Warns Unvaccinated Exactly What To Expect From Delta Variant - HuffPost\",\"description\":\"Adm. Brett Giroir also had a message for people who think they're protected with natural immunity from a previous infection.\",\"url\":\"https://www.huffpost.com/entry/brett-giroir-coronavirus-delta-warning_n_6104edcae4b0048f361d83cd\",\"urlToImage\":\"https://img.huffingtonpost.com/asset/6104f476260000ea84524707.png?cache=uvxs7qwadq&ops=1778_1000\",\"publishedAt\":\"2021-07-31T07:00:00Z\",\"content\":\"Adm. Brett Giroir, the Trump White Houses COVID-19 testing czar, on Friday spelled out what unvaccinated people should expect from the spread of the highly transmissible delta variant of the coronavi… [+1391 chars]\"},{\"source\":{\"id\":\"fox-news\",\"name\":\"Fox News\"},\"author\":\"Dom Calicchio\",\"title\":\"CDC boss Walensky, after Fox TV appearance, walks back vaccine mandate remarks - Fox News\",\"description\":\"Dr. Rochelle Walensky, director of the U.S. Centers for Disease Control and Prevention, issued a clarification statement Friday night after claiming on Fox News’ “Special Report” that the U.S. was “looking into” a possible nationwide vaccine mandate.\",\"url\":\"https://www.foxnews.com/media/cdc-boss-walensky-after-fox-tv-appearance-walks-back-vaccine-mandate-remarks\",\"urlToImage\":\"https://cf-images.us-east-1.prod.boltdns.net/v1/static/694940094001/f2ca4240-5f77-4e7e-a14b-17c99d3c626a/c16dcd1f-08ef-44dc-b530-90bed8ec8baf/1280x720/match/image.jpg\",\"publishedAt\":\"2021-07-31T06:58:17Z\",\"content\":\"Dr. Rochelle Walensky, director of the U.S. Centers for Disease Control and Prevention, issued a clarification statement Friday night after claiming on Fox News \\\"Special Report\\\" that the U.S. was \\\"lo… [+4068 chars]\"},{\"source\":{\"id\":\"cnn\",\"name\":\"CNN\"},\"author\":\"Aya Elamroussi, CNN\",\"title\":\"New Orleans EMS can't keep up with calls due to the Covid-19 surge as mayor restores a mask mandate - CNN\",\"description\":\"Emergency medical responders in New Orleans have been hit so hard by the resurgence in Covid-19 cases that the city doesn't have the capacity to handle 911 calls, the mayor said Friday as she announced a new mask mandate and a contract to increase EMS resourc…\",\"url\":\"https://www.cnn.com/2021/07/31/us/new-orleans-covid-19-surge/index.html\",\"urlToImage\":\"https://cdn.cnn.com/cnnnext/dam/assets/210731003640-bourbon-street-la-0723-super-tease.jpg\",\"publishedAt\":\"2021-07-31T06:25:00Z\",\"content\":\"(CNN)Emergency medical responders in New Orleans have been hit so hard by the resurgence in Covid-19 cases that the city doesn't have the capacity to handle 911 calls, the mayor said Friday as she an… [+3643 chars]\"},{\"source\":{\"id\":\"cbs-news\",\"name\":\"CBS News\"},\"author\":\"Clare Clare\",\"title\":\"Justice Department says IRS must give Trump's tax returns to Congress - CBS News\",\"description\":\"The decision puts an apparent end in sight to the yearslong battle over the records.\",\"url\":\"https://www.cbsnews.com/news/trump-tax-returns-irs-congress-justice-department/\",\"urlToImage\":\"https://cbsnews3.cbsistatic.com/hub/i/r/2021/02/08/214bf190-6024-4d7a-a645-d3a47739c90f/thumbnail/1200x630/4dd1e53fb3aa5cc8469f58b7ceb151a3/gettyimages-1230553516.jpg\",\"publishedAt\":\"2021-07-31T05:24:00Z\",\"content\":\"The Justice Department on Friday said the Treasury Department must hand over former President Trump's tax returns to the House Ways and Means Committee, putting an apparent end to the yearslong battl… [+4460 chars]\"},{\"source\":{\"id\":null,\"name\":\"PhoneArena\"},\"author\":\"Alan Friedman\",\"title\":\"Samsung leaks image of Galaxy Z Fold 3 in virtual Media Center for the Tokyo Olympics - PhoneArena\",\"description\":\"Samsung is racking up promotional points by handing out free limited edition Galaxy S21 5G handsets to Olympic and Paralympic athletes. In addition, fans at home can visit the virtual Galaxy ...\",\"url\":\"https://www.phonearena.com/news/samsung-gives-away-limited-edition-5g-handsets-to-olympic-athletes-in-tokyo_id134017\",\"urlToImage\":\"https://m-cdn.phonearena.com/images/article/134017-wide-two_1200/Samsung-gives-free-limited-edition-models-of-Galaxy-S21-5G-to-Olympic-and-Paralympic-participants.jpg\",\"publishedAt\":\"2021-07-31T03:33:30Z\",\"content\":null},{\"source\":{\"id\":null,\"name\":\"KSAT San Antonio\"},\"author\":\"John Paul Barajas, Joe Herrera\",\"title\":\"Doctors explain how Delta variant can infect those who are fully vaccinated, lead to increase in hospitalizations - KSAT San Antonio\",\"description\":\"“Unfortunately, we’re in a new phase of this pandemic. It means we need to wear our masks indoors, and it means you need to get your vaccination if you haven’t already.\\\"\",\"url\":\"https://www.ksat.com/news/local/2021/07/31/doctors-explain-how-delta-variant-can-infect-those-who-are-fully-vaccinated-lead-to-increase-in-hospitalizations/\",\"urlToImage\":\"https://www.ksat.com/resizer/WWkWPGUV-c4LYvYti0YSpyslJ9w=/800x450/smart/filters:format(jpeg):strip_exif(true):strip_icc(true):no_upscale(true):quality(65)/d1vhqlrjc8h82r.cloudfront.net/07-31-2021/t_0b2b94ea75104d1fb2116c2147ef2532_name_image.jpg\",\"publishedAt\":\"2021-07-31T03:23:52Z\",\"content\":\"SAN ANTONIO The number of COVID-19 Delta variant cases is going up in San Antonio, with a 66% increase in hospitalizations in the last week, according to city data.\\r\\nThe area is also seeing breakthro… [+1971 chars]\"},{\"source\":{\"id\":null,\"name\":\"Bitcoin.com\"},\"author\":null,\"title\":\"Global Cryptocurrency Adoption Doubled Since January Reaching 221 Million Users: Report – Bitcoin News - Bitcoin News\",\"description\":\"A report issued by Crypto.com, a cryptocurrency exchange, discovered the number of people using crypto has reached 221 million last June.\",\"url\":\"https://news.bitcoin.com/global-cryptocurrency-adoption-doubled-since-january-reaching-221-million-users-report/\",\"urlToImage\":\"https://static.news.bitcoin.com/wp-content/uploads/2021/07/shutterstock_678128059.jpg\",\"publishedAt\":\"2021-07-31T03:21:33Z\",\"content\":\"A new report issued by Crypto.com, a cryptocurrency exchange and fintech services firm, discovered that the number of people using cryptocurrencies has more than doubled since January, reaching 221 m… [+3216 chars]\"},{\"source\":{\"id\":null,\"name\":\"GameSpot\"},\"author\":\"George Yang\",\"title\":\"PSA: Halo Infinite Campaign Spoilers Have Leaked Via The Beta - GameSpot\",\"description\":\"Beware of Halo Infinite campaign spoilers as data-miners have gotten their hands on some files.\",\"url\":\"https://www.gamespot.com/articles/psa-halo-infinite-campaign-spoilers-have-leaked-via-the-beta/1100-6494637/\",\"urlToImage\":\"https://www.gamespot.com/a/uploads/screen_kubrick/1646/16465123/3862439-haloinfinite.jpg\",\"publishedAt\":\"2021-07-31T02:52:47Z\",\"content\":\"So far, many Halo fans have been enjoying the Halo Infinite multiplayer technical preview. However, it's been confirmed that campaign content was mistakenly included in the beta's files, leading to s… [+1491 chars]\"}]}";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        getSupportLoaderManager().initLoader(LOADER_ID, null, MainActivity.this);

        mNewsList = new ArrayList<>();
        RecyclerView mRecyclerView = findViewById(R.id.recyclerview_news);
        mRecyclerView.setLayoutManager(new LinearLayoutManager(this, RecyclerView.VERTICAL, false));
        mRecyclerView.setHasFixedSize(true);
        mNewsAdapter = new NewsAdapter(this);
        mRecyclerView.setAdapter(mNewsAdapter);

    }

    @NonNull
    @SuppressLint("StaticFieldLeak")
    @Override
    public Loader<List<News>> onCreateLoader(int id, final Bundle args) {
        return new AsyncTaskLoader<List<News>>(this) {

            @Override
            protected void onStartLoading() {
                forceLoad();
            }

            @Override
            public List<News> loadInBackground() {
                try {
                    return QueryUtils.extractNews(JSON_RESPONSE);
                } catch (IOException e) {
                    e.printStackTrace();
                    return null;
                } catch (JSONException e) {
                    e.printStackTrace();
                    return null;
                }
            }
        };
    }

    @Override
    public void onLoadFinished(@NonNull Loader<List<News>> loader, List<News> data) {
        mNewsList = data;
        mNewsAdapter.setNewsData(mNewsList);
    }

    @Override
    public void onLoaderReset(@NonNull Loader<List<News>> loader) {

    }

    @Override
    public void onClickNews(int position) {
        String url = mNewsList.get(position).getUrl();
        CustomTabsIntent.Builder builder = new CustomTabsIntent.Builder();
        CustomTabsIntent customTabsIntent = builder.build();
        customTabsIntent.launchUrl(this, Uri.parse(url));
    }
}
